% modified from: https://gits-15.sys.kth.se/giampi/kthlatex

\ProvidesPackage{beamerthemeKTH}[2016/06/21]

\mode<presentation>

\usepackage[ddmmyyyy]{datetime}
\usepackage{}
% \usepackage[default]{cantarell}

\RequirePackage{tikz}
\definecolor{kthcolor}{RGB}{25,84,166}

\setbeamertemplate{navigation symbols}{}
\setbeamersize{text margin left=1.93cm,text margin right=4mm}
\setbeamerfont{footline}{size=\fontsize{4}{11}\selectfont}

\pgfdeclareimage[width=12mm]{kthlogo}{kth/KTH-logo}

\setbeamercolor{palette primary}{bg=kthcolor,fg=white}
\setbeamercolor{palette secondary}{bg=kthcolor,fg=white}
\setbeamercolor{palette tertiary}{bg=kthcolor,fg=white}
\setbeamercolor{palette quaternary}{bg=kthcolor,fg=white}
\setbeamercolor{structure}{fg=black} % itemize, enumerate, etc
\setbeamercolor{section in toc}{fg=kthcolor} % TOC sections

\newcommand{\kthlines}{%
\begin{tikzpicture}[line width=0.5pt,rounded corners=2pt,color=kthcolor,x=2mm,y=2mm]
  \clip (4,-1) rectangle (81, 12);
  \draw (0,9.5) -- (15,9.5) -- (15,1.7) -- (30,1.7) -- (30,8) -- (44.5,8) -- (44.5,0) -- (55,0) -- (55,9.5)
  -- (63,9.5) -- (63,1) -- (77,1) -- (77,8) -- (82,8) -- (82,6) -- (95,6);
  \draw (0,8) -- (5,8) -- (5,4) -- (20,4) -- (20,9.5) -- (30.5,9.5) -- (30.5,4) -- (48,4) -- (48,7) -- (66,7)
  -- (66,5) -- (73,5) -- (73,10) -- (84.5,10) -- (84.5,3) -- (95,3);
  \draw (0,7) -- (7,7) -- (7,11.5) -- (11,11.5) -- (11,5) -- (18,5) -- (18,8) -- (28.5,8) -- (28.5,5)
  -- (32,5) -- (32,7) -- (36,7) -- (36,5.5) -- (60,5.5) -- (60,11.5) -- (68,11.5) -- (68,7) -- (80,7) -- (80,11) -- (95,11);
  \draw (0,1.7) -- (9,1.7) -- (9,0) -- (33,0) -- (33,1.7) -- (76,1.7) -- (76,0) -- (95,0);
  \draw (0,1) -- (13,1) -- (13,7) -- (25,7) -- (25,1) -- (42,1) -- (42,10) -- (57,10) -- (57,4) -- (61.7,4)
  -- (61.7,8) -- (71,8) -- (71,-0.5) -- (82,-0.5) -- (82,4) -- (95,4);
\end{tikzpicture}}


\newcommand{\kthsingleline}{%
  \begin{tikzpicture}[thin,color=kthcolor,x=1cm]
    \draw (0,0);
    \draw (0.45,0) -- (15.55,0);
  \end{tikzpicture}
}

% \newcommand{\startpage}{%
% \usebackgroundtemplate{\vbox{\null\vspace{4mm}
%   \hspace{4mm}\pgfuseimage{kthlogo}\par
%   \vspace{43mm}\hbox{\hspace{3mm}\kthlines}%
%   \hbox{\hspace{3mm}\kthsingleline}}}}

\usebackgroundtemplate{
  \vbox{
    \null
    \vspace{4mm}
    \hspace{4mm}\pgfuseimage{kthlogo}\par
    \vspace{6.96cm}
    \kthsingleline
  }
}


% frametitle
\setbeamertemplate{frametitle}{
  \begin{tikzpicture}[thin,color=kthcolor,x=1cm]
    \draw (0,0);
    % \draw (0.0,0) -- (15.55,0);
    \draw (0,-0.9) node[align=left, right=0,inner sep=0,outer sep=0, black,font=\bfseries] {\LARGE\strut\insertframetitle};
    \draw (0,-1.46) node[align=left, right=0,inner sep=0,outer sep=0, black] {\normalsize\hspace{0.13ex}\strut\insertframesubtitle}; 
    % 0.13ex is to slightly improve adjustment (not possible automatically, since glyph size is not known to LaTeX)
  \end{tikzpicture}
}

\setbeamertemplate{title page}{
  \begin{tikzpicture}[thin,overlay,color=kthcolor,x=1cm]
    \draw (0,0);
    % \draw (0.0,0) -- (15.55,0);
    \draw (-1.0,0) node[align=left, right=0,inner sep=0,outer sep=0, black,font=\bfseries] {\huge\strut\inserttitle};
    \draw (-1.0,-0.7) node[align=left, right=0,inner sep=0,outer sep=0, black] {\Large\hspace{0.13ex}\strut\insertsubtitle};
    \draw (-1.0,-2) node[align=left, right=0,inner sep=0,outer sep=0, black] {\normalsize\hspace{0.25ex}\strut\insertauthor};
    \draw (-1.0,-2.4) node[align=left, right=0,inner sep=0,outer sep=0, black] {\small\hspace{0.34ex}\strut\insertinstitute};
    % 0.13ex is to slightly improve adjustment (not possible automatically, since glyph size is not known to LaTeX)
  \end{tikzpicture}

%   \begin{tikzpicture}[line width=0.5pt,rounded corners=2pt,color=kthcolor,x=2mm,y=2mm]
%   \clip (4,-1) rectangle (81, 12);
%   \draw (0,9.5) -- (15,9.5) -- (15,1.7) -- (30,1.7) -- (30,8) -- (44.5,8) -- (44.5,0) -- (55,0) -- (55,9.5)
%   -- (63,9.5) -- (63,1) -- (77,1) -- (77,8) -- (82,8) -- (82,6) -- (95,6);
%   \draw (0,8) -- (5,8) -- (5,4) -- (20,4) -- (20,9.5) -- (30.5,9.5) -- (30.5,4) -- (48,4) -- (48,7) -- (66,7)
%   -- (66,5) -- (73,5) -- (73,10) -- (84.5,10) -- (84.5,3) -- (95,3);
%   \draw (0,7) -- (7,7) -- (7,11.5) -- (11,11.5) -- (11,5) -- (18,5) -- (18,8) -- (28.5,8) -- (28.5,5)
%   -- (32,5) -- (32,7) -- (36,7) -- (36,5.5) -- (60,5.5) -- (60,11.5) -- (68,11.5) -- (68,7) -- (80,7) -- (80,11) -- (95,11);
%   \draw (0,1.7) -- (9,1.7) -- (9,0) -- (33,0) -- (33,1.7) -- (76,1.7) -- (76,0) -- (95,0);
%   \draw (0,1) -- (13,1) -- (13,7) -- (25,7) -- (25,1) -- (42,1) -- (42,10) -- (57,10) -- (57,4) -- (61.7,4)
%   -- (61.7,8) -- (71,8) -- (71,-0.5) -- (82,-0.5) -- (82,4) -- (95,4);
% \end{tikzpicture}
}

% simple dot for itemize
\setbeamertemplate{itemize items}{\raisebox{0.2em}{\scalebox{1}{$\centerdot$}}}

% no indent for itemize
\settowidth{\leftmargini}{\usebeamertemplate{itemize item}}
\addtolength{\leftmargini}{\labelsep}

% footer
\setbeamertemplate{footline}
{
  \begin{tikzpicture}[]
    \draw (0,0);
    \draw (0.45,0.21)  node[color=gray, align=left, right=0,inner sep=0,outer sep=0,text height=1.5ex, text depth=0.25ex] {\insertshortdate $\quad$ \insertshorttitle $\quad$ \insertshortauthor $\quad$ \insertshortinstitute};
    \draw (15.55,0.21)  node[color=gray, align=right, left=0,inner sep=0,outer sep=0,text height=1.5ex, text depth=0.25ex] {\insertframenumber};
  \end{tikzpicture}
}

% TODOs 
% other fonts for titles